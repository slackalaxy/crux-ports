# Description: gtk+2 terminal emulator widget
# URL: http://ftp.gnome.org/pub/gnome/sources/vte/
# Maintainer: Petar Petrov, slackalaxy at gmail dot com
# Depends on: gtk xorg-libxdamage xorg-libxrender

name=vte
version=0.28.2
release=3
source=(http://ftp.gnome.org/pub/gnome/sources/vte/0.28/$name-$version.tar.xz
	fix_meta_alt_keybinding.patch vte.escape.cpu.usage.diff stream-mem.patch attachment_362458.patch)

build() {
	cd $name-$version

	# https://bugzilla.gnome.org/show_bug.cgi?id=663779
	patch -p1 < $SRC/fix_meta_alt_keybinding.patch

	# Escape sequences can cause high CPU usage (CVE-2012-2738):
	patch -p1 < $SRC/vte.escape.cpu.usage.diff

	# https://bugs.launchpad.net/ubuntu/+source/vte/+bug/778872/comments/5
	patch -p1 < $SRC/stream-mem.patch
	
	./configure --prefix=/usr \
	--sysconfdir=/usr/etc \
	--libexecdir=/usr/lib/$name \
	--disable-introspection \
	--enable-python \
	--enable-gnome-pty-helper \
	--with-gtk=2.0 \
	--with-default-emulation=xterm \
	--disable-gtk-doc-html \
	--disable-nls

	make
	make install DESTDIR=$PKG
	
	rm -rf $PKG/usr/share/{gtk-doc,locale}
}
