# Description: KDE Framework - kwindowsystem
# URL: https://api.kde.org/frameworks/kwindowsystem/html/index.html
# Maintainer: Petar Petrov, slackalaxy at gmail dot com
# Depends on: extra-cmake-modules qt5

name=kwindowsystem
version=5.115.0
release=1
source=(https://invent.kde.org/frameworks/kwindowsystem/-/archive/v$version/kwindowsystem-v$version.tar.bz2)

build() {
  if [[ ! -e /usr/include/xkbcommon/xkbcommon-x11.h ]]; then
    printf '\e[31m%s\e[m\n' "libxkbcommon is not built with x11 support but needs to be!"
    printf '\e[33m%s\e[m\n' "Install xkeyboard-config and rebuild libxkbcommon and qt5 in that order to build $name"
    exit 1
  fi

  rm -r $name-v$version/poqm/*

  cmake -S $name-v$version -B build -G Ninja \
    -D CMAKE_INSTALL_PREFIX=/usr \
    -D CMAKE_INSTALL_LIBDIR=lib \
    -D CMAKE_BUILD_TYPE=Release \
    -D CMAKE_CXX_FLAGS_RELEASE="$CXXFLAGS" \
    -D CMAKE_C_FLAGS_RELEASE="$CFLAGS" \
    -Wno-dev

  cmake --build build
  DESTDIR=$PKG cmake --install build
}
