# Description: Microsoft Edge stable
# URL: https://www.microsoft.com/en-us/edge
# Maintainer: Petar Petrov, slackalaxy at gmail dot com
# Depends on: cups double-conversion gnutls icu libidn2 libsecret nss qt5 qt6-base

name=microsoft-edge
version=135.0.3179.98
release=1
source=(https://packages.microsoft.com/repos/edge/pool/main/m/microsoft-edge-stable/microsoft-edge-stable_${version}-1_amd64.deb)

build() {
	bsdtar -xf microsoft-edge-stable_${version}-1_amd64.deb
	bsdtar -xf data.tar.xz
	
	mkdir -p $PKG/usr/lib/$name
	cp -a $SRC/opt/microsoft/msedge/* $PKG/usr/lib/$name
	
	# Copy data
	mkdir -p $PKG/usr/share/pixmaps
	cp -a $SRC/usr/share/{appdata,applications,man} $PKG/usr/share
	
	cp $SRC/opt/microsoft/msedge/product_logo_48.png $PKG/usr/share/pixmaps/$name.png
	
	mkdir -p $PKG/usr/bin
	cd $PKG/usr/bin
	ln -s ../lib/$name/msedge $name-stable
	
	find $PKG/usr/lib/$name/locales/ -type f -not -name "en-US.pak" -delete
	
	# this is needed after recent libxml2 update
	cd $PKG/usr/lib/$name/
	ln -s /usr/lib/libxml2.so libxml2.so.2
}
