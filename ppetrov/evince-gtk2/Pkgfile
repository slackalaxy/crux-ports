# Description: Old Evince
# URL: https://download.gnome.org/sources/evince/
# Maintainer: Petar Petrov, slackalaxy at gmail dot com
# Depends on: gtk libxml210 poppler21 xorg-libxdamage

name=evince-gtk2
version=2.32.0
release=5
source=(https://download.gnome.org/sources/evince/${version%.*}/evince-$version.tar.bz2)

build() {
	cd evince-$version
	
	#export CXXFLAGS+=" -I/usr/include/poppler21/"
	export PKG_CONFIG_PATH="/usr/lib/poppler21/pkgconfig:/usr/lib/libxml210/pkgconfig:$PKG_CONFIG_PATH"
	
	sed -i 's:<poppler.h>:<poppler21/glib/poppler.h>:g' backend/pdf/ev-poppler.cc
	sed -i 's:<poppler-document.h>:<poppler21/glib/poppler-document.h>:g' backend/pdf/ev-poppler.cc
	sed -i 's:<poppler-page.h>:<poppler21/glib/poppler-page.h>:g' backend/pdf/ev-poppler.cc
	
	#sed -i 's:<libxml/tree.h>:<libxml210/libxml2/libxml/tree.h>:g' backend/pdf/ev-poppler.cc
	#sed -i 's:<libxml/parser.h>:<libxml210/libxml2/libxml/parser.h>:g' backend/pdf/ev-poppler.cc
	#sed -i 's:<libxml/xpath.h>:<libxml210/libxml2/libxml/xpath.h>:g' backend/pdf/ev-poppler.cc
	#sed -i 's:<libxml/xpathInternals.h>:<libxml210/libxml2/libxml/xpathInternals.h>:g' backend/pdf/ev-poppler.cc
	#sed -i 's:<libxml/xmlversion.h>:<libxml210/libxml2/libxml/xmlversion.h>:g' backend/pdf/ev-poppler.cc

	CXXFLAGS="$CXXFLAGS -Wl,-rpath,/usr/lib/poppler21" \
	CFLAGS="$CFLAGS -Wl,-rpath,/usr/lib/poppler21" \
	./configure --prefix=/usr \
	--sysconfdir=/usr/etc/evince \
	--libexecdir=/usr/lib/evince \
	--without-keyring \
	--without-gconf \
	--disable-dbus \
	--enable-pdf \
	--enable-tiff \
	--enable-djvu \
	--enable-t1lib \
	--enable-pixbuf \
	--enable-comics \
	--enable-impress \
	--enable-thumbnailer \
	--enable-gtk-doc-html=no \
	--disable-dvi \
	--disable-nls \
	--disable-static \
	--disable-schemas-install \
	--disable-scrollkeeper \
	--disable-nautilus \
	--disable-introspection \
	--disable-maintainer-mode

	sed -i "s:help::g" Makefile

	make LDFLAGS="-lICE" 
	make install DESTDIR=$PKG

	# Fix desktop entry
	sed -i "/NoDisplay=true/d" $PKG/usr/share/applications/evince.desktop
	sed -i "s:Categories=GNOME;GTK;Graphics;VectorGraphics;Viewer;:Categories=Office:" $PKG/usr/share/applications/evince.desktop
	
	# Remove these
	rm -rf $PKG/*.schemas
	rm -rf $PKG/usr/share/{locale,gnome,omf,gtk-doc}
	
	rm -f $PKG/{,usr/}lib/*.la
}
