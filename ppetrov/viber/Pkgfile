# Description: Viber for PC
# URL: https://viber.com
# Maintainer: Petar Petrov, slackalaxy at gmail dot com
# Depends on: cups double-conversion graphite2 gst-libav gst-plugins-bad gst-plugins-good gst-plugins-ugly keyutils krb5 libmng libtiff44 libxkbcommon minizip mtdev openssl11 snappy tslib wayland xorg-libxcomposite xorg-libxscrnsaver xorg-libxtst xorg-xcb-util-image xorg-xcb-util-keysyms xorg-xcb-util-renderutil xorg-xcb-util-wm

name=viber
version=current
#version=$(ar p $name.deb control.tar.gz | tar zxO ./control | grep Version | awk '{print $2}' | cut -d- -f1)
release=7
source=(http://download.cdn.viber.com/cdn/desktop/Linux/viber.deb)

build() {
	cd $PKG
	ar p $SRC/$name.deb data.tar.xz | xz -d | tar xv
	mkdir -p $PKG/usr/lib/$name
	mv $PKG/opt/$name/* $PKG/usr/lib/$name
	rm -rf $PKG/opt
	rm -rf $PKG/usr/share/viber
	
	# Fix desktop launcher
	sed -i 's:/opt/viber/Viber:/usr/bin/ViberPC:' $PKG/usr/share/applications/$name.desktop
	sed -i 's:/usr/share/pixmaps/viber.png:viber:' $PKG/usr/share/applications/$name.desktop
	
	mkdir -p $PKG/usr/bin
	printf "#!/bin/sh\n/usr/lib/$name/Viber\n" > $PKG/usr/bin/ViberPC
	ln -s ViberPC $PKG/usr/bin/$name
	chmod +x $PKG/usr/bin/ViberPC
	
	chmod 755 $PKG/usr
	chmod 755 $PKG/usr/share
	find $PKG/usr/lib/viber/translations/ -type f -not -name "*_en.qm" -delete
}
