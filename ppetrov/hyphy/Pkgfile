# Description: Hypothesis Testing using Phylogenies
# URL: https://github.com/veg/hyphy/
# Maintainer: Petar Petrov, slackalaxy at gmail dot com
# Depends on: hwloc libevent openblas openmpi openpmix

name=hyphy
version=2.5.90
release=1
source=(https://github.com/veg/hyphy/archive/$version/$name-$version.tar.gz)

build() {
	cd $name-$version

	# Use our flags
	sed -i "s:-fsigned-char -O3:$CFLAGS -fsigned-char:g" CMakeLists.txt

	# Use _only_ our flags. You may wish to comment out the lines below to
	# enable flags automatically set for you architecture.
	sed -i "s:-march=native -mtune=native -mavx::g" CMakeLists.txt
	sed -i "s:-mavx::g" CMakeLists.txt
	sed -i "s:-mfma::g" CMakeLists.txt
	sed -i "s:-msse3::g" CMakeLists.txt
	sed -i "s:-mno-avx::g" CMakeLists.txt
	sed -i "s:-mno-sse3::g" CMakeLists.txt

	mkdir -p build
	cd build
	cmake \
	-D CMAKE_INSTALL_PREFIX=/usr \
	-D CMAKE_BUILD_TYPE=Release ..

	#make MP HYPHYMPI
	make
	make install DESTDIR=$PKG
	
	find $PKG/ -name "*README*" -delete
}
