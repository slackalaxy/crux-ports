# Description: Bluecurve GTK 2/3/4 theme
# URL: https://github.com/neeeeow/Bluecurve
# Maintainer: Petar Petrov, slackalaxy at gmail dot com
# Depends on: gnome-icon-theme gtk gtk4

name=bluecurve
version=3.0.0
release=5
source=(https://github.com/neeeeow/Bluecurve/archive/v$version/Bluecurve-$version.tar.gz)

build() {
  cmake -S Bluecurve-$version/engine/src -B build            \
        -DCMAKE_BUILD_TYPE=Release            \
        -DCMAKE_INSTALL_PREFIX=/usr           \
        -DCMAKE_INSTALL_LIBDIR=lib            \
        -DCMAKE_C_FLAGS_RELEASE="$CFLAGS"     \
        -DCMAKE_CXX_FLAGS_RELEASE="$CXXFLAGS" \
        -Wno-dev

  cmake --build build

  cd build
  make
  mkdir -p $PKG/usr/lib/gtk-2.0/2.10.0/engines
  cp libbluecurve.so $PKG/usr/lib/gtk-2.0/2.10.0/engines
  
  cd ../Bluecurve-$version
  mkdir -p $PKG/usr/share/{icons,themes}
  cp -a {icons,themes} $PKG/usr/share
  
  sed -i 's:Inherits=mate,gnome,crystalsvg:Inherits=gnome:' $PKG/usr/share/icons/Bluecurve/index.theme
  
  # Fix the following warning:
  # Gtk-WARNING **: 10:33:05.470: Theme parsing error: gtk-style.css:127:18:
  # The :insensitive pseudo-class is deprecated. Use :disabled instead.
  sed -i 's|window:insensitive|window:disabled|g' $PKG/usr/share/themes/Bluecurve/gtk-3.0/gtk-style.css
  
  mkdir -p $PKG/etc/profile.d
  echo "export GTK_OVERLAY_SCROLLING=0" > $PKG/etc/profile.d/bluecurve.sh
  
  find $PKG/ -name "*README*" -delete
}
